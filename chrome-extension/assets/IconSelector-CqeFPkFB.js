import{u as S,r as c,R as F,n as R,j as s,C as A,U as L}from"./index-CQcVGI0j.js";import{L as U}from"./loader-circle-Ckjz1Rfe.js";import{L as E}from"./monitor-4Kc3nfXb.js";const B=({url:g,currentIcon:j,onSelect:y,onCustom:x})=>{const p=S(),[v,b]=c.useState([]),[f,i]=c.useState(j||""),[n,d]=c.useState(""),[l,h]=c.useState(!1),w=F.useRef(null);c.useEffect(()=>{if(!g)return;const e=R(g);if(!e)return;const t=[{url:e.logodev,name:"Logo.dev",status:"loading"},{url:e.unavatar,name:"Unavatar",status:"loading"},{url:e.google,name:"Google",status:"loading"},{url:e.ddg,name:"DuckDuckGo",status:"loading"},{url:e.iconhorse,name:"Icon Horse",status:"loading"},{url:e.direct,name:"Direct",status:"loading"}];b(t),t.forEach((r,a)=>{N(r.url,o=>{b(u=>{const m=[...u];return m[a]={...r,status:o?"success":"error"},m})})})},[g]);const N=(e,t)=>{const r=new Image,a=setTimeout(()=>{r.onload=null,r.onerror=null,t(!1)},5e3);r.onload=()=>{clearTimeout(a),t(!0)},r.onerror=()=>{clearTimeout(a),t(!1)},r.src=e},I=e=>{i(e),y(e),h(!1)},C=e=>{d(e),i(e),x(e)},k=async e=>{const t=e.target.files?.[0];if(!t)return;if(t.size>2*1024*1024){p.showAlert("图标文件大小不能超过 2MB");return}if(!t.type.startsWith("image/")){p.showAlert("请上传图片文件");return}const r=new FileReader;r.onload=a=>{const o=a.target?.result;d(o),i(o),x(o),h(!0)},r.readAsDataURL(t)};return s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("label",{className:"text-sm font-medium",style:{color:"rgba(255, 255, 255, 0.7)"},children:"选择图标源"}),s.jsx("button",{onClick:()=>h(!l),className:"text-xs px-3 py-1.5 rounded-md transition-colors",style:{backgroundColor:l?"rgba(10, 132, 255, 0.2)":"rgba(255, 255, 255, 0.1)",color:l?"#0A84FF":"rgba(255, 255, 255, 0.6)",border:"1px solid "+(l?"rgba(10, 132, 255, 0.3)":"rgba(255, 255, 255, 0.1)")},children:"自定义图标"})]}),!l&&s.jsx("div",{className:"grid grid-cols-3 gap-3",children:v.filter(e=>e.status!=="error").map((e,t)=>s.jsxs("button",{onClick:()=>e.status==="success"&&I(e.url),disabled:e.status!=="success",className:`relative p-3 rounded-lg border transition-all ${f===e.url?"border-[#0A84FF] bg-[#0A84FF]/10":"border-white/10 hover:border-white/20"} ${e.status!=="success"?"cursor-wait":"cursor-pointer"}`,style:{backgroundColor:f===e.url?"rgba(10, 132, 255, 0.1)":"rgba(255, 255, 255, 0.05)"},children:[s.jsxs("div",{className:"w-12 h-12 mx-auto mb-2 rounded-lg overflow-hidden flex items-center justify-center",style:{backgroundColor:"rgba(255, 255, 255, 0.1)"},children:[e.status==="loading"&&s.jsx(U,{size:20,className:"animate-spin",style:{color:"rgba(255, 255, 255, 0.4)"}}),e.status==="success"&&s.jsx("img",{src:e.url,alt:e.name,className:"w-full h-full object-cover",onError:r=>{b(a=>{const o=[...a],u=a.findIndex(m=>m.url===e.url);return u!==-1&&(o[u]={...e,status:"error"}),o})}})]}),s.jsx("div",{className:"text-xs text-center truncate",style:{color:"rgba(255, 255, 255, 0.6)"},children:e.name}),f===e.url&&s.jsx("div",{className:"absolute top-2 right-2 w-5 h-5 rounded-full bg-[#0A84FF] flex items-center justify-center",children:s.jsx(A,{size:12,color:"white"})}),e.status==="loading"&&s.jsx("div",{className:"absolute bottom-2 right-2 w-2 h-2 rounded-full bg-yellow-500 animate-pulse"})]},t))}),l&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"relative",children:[s.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2",style:{color:"rgba(255, 255, 255, 0.4)"},size:18}),s.jsx("input",{type:"text",value:n,onChange:e=>C(e.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-lg outline-none transition-all",style:{backgroundColor:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.9)"},placeholder:"粘贴图标 URL 或 Base64..."})]}),s.jsxs("label",{className:"w-full px-4 py-2.5 rounded-lg cursor-pointer transition-colors flex items-center justify-center gap-2 text-sm font-medium",style:{backgroundColor:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.15)",color:"rgba(255, 255, 255, 0.8)"},children:[s.jsx(L,{size:18}),"上传图片文件",s.jsx("input",{ref:w,type:"file",accept:"image/*",onChange:k,className:"hidden"})]}),n&&s.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg",style:{backgroundColor:"rgba(255, 255, 255, 0.05)"},children:[s.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden flex items-center justify-center shrink-0",style:{border:"2px solid rgba(255, 255, 255, 0.15)",backgroundColor:"rgba(255, 255, 255, 0.05)"},children:s.jsx("img",{src:n,alt:"自定义图标预览",className:"w-full h-full object-cover",onError:()=>d("")})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"text-sm font-medium mb-1",style:{color:"rgba(255, 255, 255, 0.9)"},children:"自定义图标"}),s.jsx("div",{className:"text-xs truncate",style:{color:"rgba(255, 255, 255, 0.5)"},children:n.startsWith("data:")?"已上传的图片":n})]}),s.jsx("button",{onClick:()=>{d(""),i(""),x("")},className:"text-sm font-medium px-3 py-1.5 rounded-md transition-colors",style:{color:"rgba(239, 68, 68, 0.9)",backgroundColor:"rgba(239, 68, 68, 0.1)"},children:"清除"})]})]})]})})};export{B as I};
