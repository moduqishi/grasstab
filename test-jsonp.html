<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONP 搜索建议测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            margin: 10px 0;
        }
        .results {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            min-height: 100px;
        }
        .suggestion {
            padding: 5px;
            cursor: pointer;
        }
        .suggestion:hover {
            background: #e0e0e0;
        }
    </style>
</head>
<body>
    <h1>JSONP 搜索建议测试</h1>
    
    <div class="test-section">
        <h2>Google 搜索建议</h2>
        <input type="text" id="google-input" placeholder="输入关键词测试 Google 建议...">
        <div class="results" id="google-results">等待输入...</div>
    </div>

    <div class="test-section">
        <h2>Bing 搜索建议</h2>
        <input type="text" id="bing-input" placeholder="输入关键词测试 Bing 建议...">
        <div class="results" id="bing-results">等待输入...</div>
    </div>

    <div class="test-section">
        <h2>Baidu 搜索建议</h2>
        <input type="text" id="baidu-input" placeholder="输入关键词测试 Baidu 建议...">
        <div class="results" id="baidu-results">等待输入...</div>
    </div>

    <script>
        // JSONP 工具函数
        const jsonp = (url, callbackParam = 'callback') => {
            return new Promise((resolve, reject) => {
                const callbackName = 'jsonp_' + Date.now() + '_' + Math.round(Math.random() * 100000);
                const script = document.createElement('script');
                const separator = url.includes('?') ? '&' : '?';
                script.src = `${url}${separator}${callbackParam}=${callbackName}`;
                script.async = true;

                window[callbackName] = (data) => {
                    cleanup();
                    resolve(data);
                };

                script.onerror = () => {
                    cleanup();
                    reject(new Error(`JSONP request failed for ${url}`));
                };

                const cleanup = () => {
                    if (document.body.contains(script)) {
                        document.body.removeChild(script);
                    }
                    delete window[callbackName];
                };

                document.body.appendChild(script);
            });
        };

        // Google 测试
        let googleTimer;
        document.getElementById('google-input').addEventListener('input', (e) => {
            clearTimeout(googleTimer);
            const query = e.target.value.trim();
            const resultsDiv = document.getElementById('google-results');
            
            if (!query) {
                resultsDiv.innerHTML = '等待输入...';
                return;
            }

            resultsDiv.innerHTML = '加载中...';
            
            googleTimer = setTimeout(async () => {
                try {
                    const data = await jsonp(`https://suggestqueries.google.com/complete/search?client=firefox&q=${encodeURIComponent(query)}`, 'jsonp');
                    if (Array.isArray(data) && data[1]) {
                        resultsDiv.innerHTML = data[1].map(s => `<div class="suggestion">${s}</div>`).join('') || '无建议';
                    } else {
                        resultsDiv.innerHTML = '无建议';
                    }
                } catch (err) {
                    resultsDiv.innerHTML = '获取失败: ' + err.message;
                }
            }, 300);
        });

        // Bing 测试
        let bingTimer;
        document.getElementById('bing-input').addEventListener('input', (e) => {
            clearTimeout(bingTimer);
            const query = e.target.value.trim();
            const resultsDiv = document.getElementById('bing-results');
            
            if (!query) {
                resultsDiv.innerHTML = '等待输入...';
                return;
            }

            resultsDiv.innerHTML = '加载中...';
            
            bingTimer = setTimeout(async () => {
                try {
                    const data = await jsonp(`https://api.bing.com/qsonhs.aspx?q=${encodeURIComponent(query)}`, 'cb');
                    if (data && data.AS && data.AS.Results && data.AS.Results[0] && data.AS.Results[0].Suggests) {
                        const suggestions = data.AS.Results[0].Suggests.map(s => s.Txt);
                        resultsDiv.innerHTML = suggestions.map(s => `<div class="suggestion">${s}</div>`).join('') || '无建议';
                    } else {
                        resultsDiv.innerHTML = '无建议';
                    }
                } catch (err) {
                    resultsDiv.innerHTML = '获取失败: ' + err.message;
                }
            }, 300);
        });

        // Baidu 测试
        let baiduTimer;
        document.getElementById('baidu-input').addEventListener('input', (e) => {
            clearTimeout(baiduTimer);
            const query = e.target.value.trim();
            const resultsDiv = document.getElementById('baidu-results');
            
            if (!query) {
                resultsDiv.innerHTML = '等待输入...';
                return;
            }

            resultsDiv.innerHTML = '加载中...';
            
            baiduTimer = setTimeout(async () => {
                try {
                    const data = await jsonp(`https://suggestion.baidu.com/su?wd=${encodeURIComponent(query)}`, 'cb');
                    if (data && data.s) {
                        resultsDiv.innerHTML = data.s.map(s => `<div class="suggestion">${s}</div>`).join('') || '无建议';
                    } else {
                        resultsDiv.innerHTML = '无建议';
                    }
                } catch (err) {
                    resultsDiv.innerHTML = '获取失败: ' + err.message;
                }
            }, 300);
        });
    </script>
</body>
</html>
