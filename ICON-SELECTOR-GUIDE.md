# 图标选择器功能说明

## 概述

GrassTab 新增了智能图标选择器功能,让用户在添加或编辑应用时可以从多个备选图标源中选择,并支持自定义图标上传。

## 功能特性

### 1. 多源图标自动检测

系统会自动从以下7个图标源获取并测试可用性:

1. **Icon Horse** - 高质量图标服务
2. **Clearbit** - 企业级图标服务
3. **Unavatar** - 多源聚合服务
4. **Google** - Google S2 图标服务
5. **DuckDuckGo** - DuckDuckGo 图标服务
6. **FaviconKit** - Favicon 获取服务
7. **Direct** - 网站直接 favicon

### 2. 实时可用性检测

- ✅ **绿点**: 图标源可用,可以选择
- ❌ **红点**: 图标源不可用或加载失败
- ⏳ **灰点**: 正在测试中

### 3. 可视化选择界面

- **3列网格布局**: 清晰展示所有可用图标
- **图标预览**: 实时显示每个源的图标效果
- **选中标记**: 已选图标带蓝色边框和勾选标记
- **状态指示**: 右下角彩色圆点显示加载状态

### 4. 自定义图标支持

#### 方式一: URL 输入
```
1. 点击 "自定义图标" 按钮
2. 在输入框中粘贴图标 URL
3. 系统自动显示预览
```

#### 方式二: 文件上传
```
1. 点击 "自定义图标" 按钮
2. 点击 "上传图片文件" 按钮
3. 选择本地图片文件 (最大 2MB)
4. 系统自动转换为 Base64 并显示预览
```

## 使用流程

### 添加新应用时

1. 输入应用名称 (Name)
2. 输入应用网址 (URL)
3. URL 输入后,图标选择器自动出现
4. 等待系统检测所有图标源 (约2-5秒)
5. 点击可用的图标源进行选择
6. 或者切换到 "自定义图标" 输入自己的图标
7. 点击 "Add Shortcut" 完成添加

### 编辑现有应用时

1. 打开应用编辑界面
2. 如果URL存在,图标选择器自动显示
3. 当前使用的图标会被选中高亮
4. 可以切换到其他可用图标源
5. 或者使用 "自定义图标" 替换
6. 点击 "保存" 完成修改

## 技术细节

### 图标优先级

系统按以下优先级使用图标:

```
用户选择的图标源 > 自定义图标 > 自动降级 (7层)
```

### 加载优化

- **超时机制**: 每个图标源测试超时时间为 5 秒
- **并行加载**: 同时测试所有7个图标源
- **缓存机制**: 已加载的图标会被浏览器缓存

### 自定义图标格式

支持的图标格式:
- ✅ PNG
- ✅ JPG/JPEG
- ✅ GIF
- ✅ SVG
- ✅ WebP
- ✅ Base64 编码图片

文件大小限制:
- 最大 2MB
- 建议使用 256x256 像素或更小

## 用户界面

### 图标选择器位置

- **添加应用**: URL 输入框下方
- **编辑应用**: URL 输入框和窗口模式选项之间

### 颜色方案

- 主题色: `#0A84FF` (蓝色)
- 背景: `rgba(255, 255, 255, 0.05)` (半透明白)
- 边框: `rgba(255, 255, 255, 0.1)` (浅白边框)
- 成功色: `#34C759` (绿色)
- 错误色: `#EF4444` (红色)

### 响应式设计

- 桌面端: 3列网格
- 移动端: 自适应布局,保持3列
- 图标预览: 固定 48x48 像素
- 自定义预览: 固定 64x64 像素

## 最佳实践

### 选择图标建议

1. **优先使用前3个源**: Icon Horse, Clearbit, Unavatar 通常质量最高
2. **检查品牌一致性**: 确保图标与应用品牌匹配
3. **避免模糊图标**: 如果所有源都模糊,使用自定义上传
4. **测试多个源**: 不同源可能提供不同风格的图标

### 自定义图标技巧

1. **使用正方形图片**: 避免拉伸变形
2. **透明背景最佳**: PNG 格式带 alpha 通道
3. **高分辨率**: 至少 256x256 像素
4. **压缩优化**: 使用在线工具压缩到 2MB 以下
5. **SVG 优先**: 矢量图标永不失真

## 故障排除

### 所有图标源都显示红点

**可能原因**:
- 网络连接问题
- 网站没有提供 favicon
- CORS 限制
- 防火墙拦截

**解决方案**:
1. 检查网络连接
2. 使用自定义图标上传
3. 尝试使用代理或 VPN
4. 检查浏览器控制台错误信息

### 自定义图标上传失败

**可能原因**:
- 文件大小超过 2MB
- 文件格式不支持
- 浏览器权限问题

**解决方案**:
1. 压缩图片文件
2. 转换为支持的格式
3. 使用图标 URL 替代上传
4. 清除浏览器缓存重试

### 图标预览加载慢

**可能原因**:
- 图标源服务器响应慢
- 网络带宽限制
- 同时测试多个源

**解决方案**:
1. 等待 5-10 秒完成所有测试
2. 选择已加载的可用图标
3. 刷新页面重新测试
4. 使用自定义图标避免等待

## 更新日志

### v1.0.0 (2025-12-07)
- ✨ 新增智能图标选择器组件
- ✨ 支持7个图标源自动检测
- ✨ 实时可用性状态显示
- ✨ 支持自定义图标上传
- ✨ 支持 Base64 图标
- ✨ 集成到添加/编辑应用界面
- 🎨 优化用户界面和交互体验
- 🐛 修复图标加载超时问题

## 相关文档

- [图标系统文档](./ICON-SYSTEM.md) - 7层图标降级系统说明
- [移动端优化文档](./MOBILE-OPTIMIZATION.md) - 响应式设计说明
- [开发者文档](./CHANGELOG.md) - 完整更新日志

## 技术支持

如有问题或建议,请访问:
- GitHub Issues: [提交问题](https://github.com/moduqishi/grasstab-next/issues)
- 开发者: [@moduqishi](https://github.com/moduqishi)

---

**享受更智能的图标选择体验! 🎨✨**
